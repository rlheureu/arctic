{% extends "base.html" %}
{% block styling %}
  {{ super() }}
  <style type="text/css">
  .share-btn {
    margin-right: 2px;
    margin-left: 2px;
  }
  .modal-color-icon{
    height:90px;
  }
  .benchtab{
    display: inline-block;
    position: relative;
    top:11px;
    padding-bottom:15px;
    cursor: pointer;
  }
  .benchtab-disabled{
    cursor: default;
  }
  .benchtabsep{
    display: inline-block;
    position: relative;
    top:11px;
    padding:15px; 
  }
  .benchtabactive{
    border-bottom: 2px solid #ababab;
  }
  hr {
    border-top: 1px solid #ababab;
  }
  #pick-part-modal{
  }
  .equip-part-item{
    display: inline-block;
    width: 463px;
    height: 91px;
    margin: 4px;
    text-align: left;
    cursor: pointer;
    background-image: url("/static/images/border-normal.png");
    background-repeat: no-repeat;
    background-size: auto 90px;
  }
  .equip-part-item:hover{
    background-color: #eee;
  }
  .equipped{
    background-image: url("/static/images/border-equip.png") !important;
    background-repeat: no-repeat;
  }
  .recommended-item{
    background-image: url("/static/images/border-recommended.png");
    background-repeat: no-repeat;
  }
  .part-item-title{
    font-size: 13px;
  }
  .component-tab-cube-image{
    width:30px;
  }
  .part-item-sub{
    color:#9f9f9f;
    display:block;
    font-size: 12px;
  }
  .part-item-border{
    border-left: solid 17px #f3f3f3;
  }
  .part-item-content {
    padding:12px;
    display:inline-block;
    vertical-align: top;
    padding-left:0px;
    max-width:500px;
  }
  .part-item-icon{
    position: relative;
    width: 32px;
    left: -25px;
    top: 8px;
  }
  .part-icon-div{
    display:inline-block;
  }
  .bg-orange {
    background-color: #fede86;
  }
  .blue-button{
    background-color:#1A9DFC;
  }
  .modal-button{
    color:white;
    font-weight: normal;
    font-size: 10px;
    padding-left: 50px;
    padding-right:50px;
    margin:5px;
  }
  #part-item-list{
    padding:10px;
    background-image: url("/static/images/modal-bg.png");
    background-size: 100% 100%;
    overflow-y:auto;
    height:80%;
  }
  .equip-clickable, .pointer{
    cursor: pointer;
  }
  
  #cubedisplay-bg{
    position: absolute;
    left:17px;
  }
  #cubedisplay-middle{
    position: absolute;
    top: 0px;
    left: 17px;
  }
  #cubedisplay-display{
    position: absolute;
    top: -15px;
    left: 385px;
  }
  #cubedisplay-memory{
    position: absolute;
    top: 329px;
    left: 203px;
  }
  #cubedisplay-cpu{
    position: absolute;
    top: 285px;
    left: 320px;
  }
  #cubedisplay-gpu{
    position: absolute;
    top: 108px;
    left: 39px;
  }
  
  .label-edited{
    background-color: #ff6e19;
    position: relative;
    top: -5px;
    left: 5px;
  }
  
  .acbench-item-heading{
    font-family: 'Open Sans', sans-serif;
    color:#c2bad1;
    font-weight: 300;
    font-size: 20px;
  }

  .acbench-share-heading{
    font-family: 'Open Sans', sans-serif;
    color:#6c6974;
    font-weight: 300;
    font-size: 28px;
  }
  
  
  #ac-cube-section-gpu{
    text-align:left;
    position: absolute;
    top: 120px;
    left: 79px;
  }
  #ac-cube-section-cpu{
    text-align:left;
    position: absolute;
    top: -5px;
    left: 167px;
  }
  #ac-cube-section-memory{
    text-align:left;
    position: absolute;
    top: 255px;
    left: 79px;
  }
  #ac-cube-section-display{
    text-align:left;
    position: absolute;
    top: 394px;
    left: 165px;
  }
  
  .small-cube-icon{
    width:93px;
  }
  
  #ac-cubedisplay-middle{
    position: absolute;
    top: 102px;
    left: 503px;
    width: 162px;
  }
  #ac-cubedisplay-gpu{
    position: absolute;
    top: -37px;
    left: 339px;
  }
  #ac-cubedisplay-cpu{
    position: absolute;
    top: 87px;
    left: 488px;
  }
  #ac-cubedisplay-memory{
    position: absolute;
    top: 34px;
    left: 458px;
  }
  #ac-cubedisplay-display{
    position: absolute;
    top: -86px;
    left: 494px;
  }
  
  #bench-cube-title{
    border-left: solid 4px #cccccc;
    display: inline-block;
    padding-left: 14px;
    left: 0px;
    position: relative;
  }
  #bench-cube-subtitle, #bench-upgrade-subtitle, #bench-rig-use-subtitle{
    font-size: 14px;
    display: block;
    top: -10px;
    padding-left: 20px;
    position: relative;
  }
  #componentsection_motherboard{
    position: absolute;
    top: -16px;
    left: -274px;
  }
  #componentsection_storage{
    position: absolute;
    top: -15px;
    left: -208px;

  }
  #componentsection_power{
    position: absolute;
    top: -18px;
    left: -208px;
  }
  #componentsection_chassis{
    position: absolute;
    top: -18px;
    left: -274px;
  }
  
  #other-components-bg{
    background-image: url("/static/images/bg-white.jpg");
    width:100%;
  }
  
  #ac-cube-section-motherboard{
    position: absolute;
    top: -5px;
    left: 850px;
    text-align: left;
  }
  #ac-cube-section-storage{
    position: absolute;
    top: 120px;
    left: 930px;
    text-align: left;
  }
  #ac-cube-section-power{
    position: absolute;
    top: 255px;
    left: 930px;
    text-align: left;
  }
  #ac-cube-section-chassis{
    position: absolute;
    top: 394px;
    left: 850px;
    text-align: left;
  }
  #other-component-note-span{
    left: 840px;
    display: inline-block;
    position: absolute;
  }
  .other-component-note{
    color: #3699f4;
  }
  .cube-belongs-to{
    width:100%; border-top: 1px #2a263f solid;
  }
  .showcase-links{
    width:100%; border-bottom: 1px #2a263f solid;
  }
  .showcase-links ul{
    list-style:none;
    margin:0px;
  }
  .showcase-links ul li{
    display: inline-block;
    position: relative;
    width: 123px;
    padding-bottom: 16px;
    top: 0px;
    font-size:13px;
    margin-left: 1px;
    margin-right: 1px;
    color: #716b77;
    font-weight: 400;
    text-align: center;
  }
  .showcase-links li.active{
    border-bottom: #cccccc 2px solid;
    color: #cccccc;
    font-weight: 400;
  }
  .showcase-links li.separator{
    border-bottom: none;
    width:30px;
  }
  .showcase-links a{
    text-decoration: none;
    color:inherit;
  }
  .showcase-links a:hover{
    text-decoration: none;
    color:#309cf4;
  }
  .added-owned-part{
    padding: 15px;
    color: #2c91df;
    border: 1px solid #2c91df;
    margin-bottom: 10px;
    font-weight: bold;
  }
  .selected-rig-type{
    background-color: #676767;
    width: 200px;
    padding: 11px;
  }
  .select-rig-type{
    background-color: #d5d5d5;
    width: 200px;
    padding: 11px;
  }
  .rig-type-selector{
    display:inline-block;
    margin: 7px;
    border: #444444 solid 1px;
  }
  .select-rig-type-footer{
    background-color:#555555;
    padding: 10px;
    color: #cccccc;
  }
  .selected-rig-type-footer{
    background-color:#333333;
    padding: 10px;
    color: #cccccc;
  }
  </style>
{% endblock %}

{% block navleft %}
{% if current_user.is_authenticated %}
{{ super() }}
{% else %}

  {% if my_rig or not rig %}
  <h3 class="navbar-page-title">
    Finish building your Cube  
  </h3>
  {% else %}
  {% endif %}

{% endif %}
{% endblock %}


{% block content %}
  {% if not rig %}
  <div style="width:100%; border-bottom: 3px #2a263f solid; text-align: center;" class="wizard-steps-breadcrumbs">
    <ul>
      <li>CONFIGURE</li>
      <li>NAME</li>
      <li class="active">BUILD & FINISH</li>
    </ul>
  </div>
  <br>
  {% endif %}
  <br>

  <div class="container">
  
    <div class="row">
      <div class="col-md-6">
        <h1 id="bench-cube-title">Cube Name</h1>
        <span id="bench-cube-subtitle"></span>
      </div>
      <div class="col-md-6 align-text-right" style="padding-top:40px;">
        <div class="pull-right" style="display:inline-block;">
          {% if my_rig %}
          <button class="ac-btn " id="own-this-button" style="margin-top:13px;">
            <img src="/static/images/star_checked.png" id="owned_check"     style="width:18px;{% if rig.use != "owned" %}display:none;{% endif %}">
            <img src="/static/images/star_unchecked.png" id="owned_uncheck" style="width:18px;{% if rig.use == "owned" %}display:none;{% endif %}">
            &nbsp;&nbsp;I Own This Rig</button>
          <button class="ac-btn " id="show-share-cube" style="margin-top:13px;">
            <img style="width:13px;" src="/static/images/share-icon.png">
            &nbsp;&nbsp;Share</button>
          {% endif %}
          {% if my_rig or not rig %}
          <button class="ac-btn " id="save-cube-button" style="margin-top:13px;">Save Cube</button>
          {% else %}
          <a href="/preset" class="ac-btn " style="margin-top:13px;">Create a Cube</a>
          {% endif %}
          <button class="ac-btn" style="margin-top:13px;" id="legendIconButton">
            <img src="/static/images/legend-icon.png" style="width:18px;" class="clickable">
            &nbsp;&nbsp;<strong>LEGEND</strong>
          </button>
        </div>
      </div>
    </div>
  </div>
  <br>
  {% if rig and not my_rig %}
  <div class="cube-belongs-to">
    <div class="container">
      <div class="row">
        <div class="col-md-12" style="background-color: #5c5a67; padding: 10px;">
          <span style="color: #a2a2a2;">This cube belongs to: </span> <span style="font-weight: bold; color: #dcdcdc;">{{rig.user.profile_name}}</span>
          <span class="pull-right" style="color: #a2a2a2;">
            View a different cube: &nbsp;&nbsp;&nbsp;
            <select id="change-cube-select">
              {% for urig in rig.user.rigs %}
                <option class="nav-onclick" data-location="/bench?rig={{urig.id}}" {% if urig.id == rig.id %}selected{% endif %}>{{urig.name}}</option>
              {% endfor %}
            </select>
          </span>
        </div>
      </div>
      <br>
    </div>
  </div>
  {% endif %}

  <div class="container" id="share-cube-div" style="display:none;">
    <div class="row">
      <div class="col-sm-12" style="text-align:center;">
        <br><br><br><br><br>
        <div class="row">
          <div class="col-sm-6 col-sm-offset-3" style="text-align:center;">
            <a id="twitter-share-btn" onclick="window.open(this.href, 'newwindow', 'width=500, height=500'); $('#share-link-div').hide(); return false;" class="ac-btn share-btn">Twitter</a>
            <a id="facebook-share-btn" onclick="window.open(this.href, 'newwindow', 'width=500, height=500'); $('#share-link-div').hide(); return false;" class="ac-btn share-btn">Facebook</a>
            <a id="reddit-share-btn" onclick="window.open(this.href, 'newwindow', 'width=500, height=500'); $('#share-link-div').hide(); return false;" class="ac-btn share-btn">Reddit</a>
            <button id="get-share-link-btn" class="ac-btn share-btn">Get Link</button>
	      </div>
	    </div>
	    <br>
	    <div id="share-link-div" style="display:none;" class="row">
	      <div class="col-sm-12">
    	      <input id="share-link-input" readonly style="width: 30%;width: 30%;padding: 10px;margin: 10px;background-color: transparent;border: 1px solid #2c91df;color: #cccccc;font-size: 14px;">
    	      <span>
    	        <button id="copy-share-link-btn" type="button" class="ac-btn">Copy Link</button>
    	      </span>
	      </div>
	    </div>
        <br>
        <button id="back-to-cube-btn" class="ac-btn">Back to your cube </button>
      </div>
    </div>
  </div>
  <br><br>
  <div class="container" id="build-cube-div">
    <div class="row">
      <div class="col-sm-12" style="text-align:center;">
        
        <img src="/static/images/centered-cube-with-lines.png">
        <div id="ac-cube-section-cpu" data-equip-type="cpu" data-equip-title="EQUIP A PROCESSOR">
          <img src="/static/cube-images/ac-cube-small-default.png" id="ac-cubedisplay-cpu" class="equip-clickable small-cube-icon" />
          <span class="acbench-item-heading equip-clickable" style="display:inline-block;">Processor</span>
          <span class="label label-edited">EDITED</span>
          <button class="ac-btn equipbutton" style="display: block; margin-top: 5px;">Equip An Item</button>
          <div id="ac-cpu-section" class="equip-clickable item-slot-section"></div>
        </div>
        
        <div id="ac-cube-section-gpu" data-equip-type="gpu" data-equip-title="EQUIP A GRAPHICS CARD">
          <img src="/static/cube-images/ac-cube-small-default.png" id="ac-cubedisplay-gpu" class="equip-clickable small-cube-icon"/>
          <span class="acbench-item-heading equip-clickable" style="display:inline-block;">Graphics</span>
          <span class="label label-edited">EDITED</span>
          <button class="ac-btn equipbutton" style="display: block; margin-top: 5px;">Equip An Item</button>
          <div id="ac-gpu-section" class="equip-clickable item-slot-section"></div>
        </div>
        
        <div id="ac-cube-section-memory" data-equip-type="memory" data-equip-title="EQUIP MEMORY">
          <img src="/static/cube-images/ac-cube-small-default.png" id="ac-cubedisplay-memory" class="equip-clickable small-cube-icon" />
          <span class="acbench-item-heading equip-clickable" style="display:inline-block;">Memory</span>
          <span class="label label-edited">EDITED</span>
          <button class="ac-btn equipbutton" style="display: block; margin-top: 5px;">Equip An Item</button>
          <div id="ac-memory-section" class="equip-clickable item-slot-section"></div>
        </div>
        
        <div id="ac-cube-section-display" data-equip-type="display" data-equip-title="EQUIP A DISPLAY">
          <img src="/static/cube-images/ac-cube-small-default.png" id="ac-cubedisplay-display" class="equip-clickable small-cube-icon"/>
          <span class="acbench-item-heading equip-clickable" style="display:inline-block;">Display</span>
          <span class="label label-edited">EDITED</span>
          <button class="ac-btn equipbutton" style="display: block; margin-top: 5px;">Equip An Item</button>
          <div id="ac-display-section" class="equip-clickable item-slot-section"></div>
        </div>
        
        <!-- CUBE DISPLAY -->
        <img src="/static/cube-images/ac-cube-middle-default.png" id="ac-cubedisplay-middle" />
        <!--// Cube DISPLAY -->
        
        <div id="ac-cube-section-motherboard" data-equip-type="motherboard" data-equip-title="EQUIP A MOTHERBOARD">
          <span class="acbench-item-heading other-clickable" style="display:inline-block;">Motherboard <span class="other-component-note">*</span></span>
          <span class="label label-edited">EDITED</span>
          <button class="ac-btn other-clickable other-clickable-btn" style="display: block; margin-top: 5px;">Equip An Item</button>
          <div id="ac-motherboard-section" class="item-slot-section other-clickable"></div>
        </div>
        <div id="ac-cube-section-storage" data-equip-type="storage" data-equip-title="EQUIP STORAGE">
          <span class="acbench-item-heading other-clickable" style="display:inline-block;">Storage <span class="other-component-note">*</span></span>
          <span class="label label-edited">EDITED</span>
          <button class="ac-btn other-clickable other-clickable-btn" style="display: block; margin-top: 5px;">Equip An Item</button>
          <div id="ac-storage-section" class="item-slot-section other-clickable"></div>
        </div>
        <div id="ac-cube-section-power" data-equip-type="power" data-equip-title="EQUIP A POWER SUPPLY">
          <span class="acbench-item-heading other-clickable" style="display:inline-block;">Power Supply <span class="other-component-note">*</span></span>
          <span class="label label-edited">EDITED</span>
          <button class="ac-btn other-clickable other-clickable-btn" style="display: block; margin-top: 5px;">Equip An Item</button>
          <div id="ac-power-section" class="item-slot-section other-clickable"></div>
        </div>
        <div id="ac-cube-section-chassis" data-equip-type="chassis" data-equip-title="EQUIP CHASSIS">
          <span class="acbench-item-heading other-clickable" style="display:inline-block;">Chassis <span class="other-component-note">*</span></span>
          <span class="label label-edited">EDITED</span>
          <button class="ac-btn other-clickable other-clickable-btn" style="display: block; margin-top: 5px;">Equip An Item</button>
          <div id="ac-chassis-section" class="item-slot-section other-clickable"></div>
        </div>
        
        <br><br><br><br><br>
        <span id="other-component-note-span" class="other-component-note">* Equip core items to fill in secondary stats</span>
        <br><br><br><br><br>
      </div>
    </div>   
    
  </div>
  
  {% if my_rig and rig.use == "owned" %}
  <div class="container" id="owned-parts-div">
    <div class="row">
      <div class="col-md-12">
        <span class="wizard-sub-heading">Owned Parts for <strong>{{rig.name}}</strong> ({{rig.owned_parts|length}})</span>
        <hr>
        {% for part in rig.owned_parts %}
          <div class="owned-parts-list-item-container">
            <span class="owned-parts-list-item-header">{{part.component.get_type_str()}}</span><br>
            <span class="owned-parts-list-item-title fg-{{part.component.get_performance_color()}} clickable"
                  data-color="{{part.component.get_performance_color()}}"
                  data-part-id="{{part.id}}"
                  data-equipped-str="equipped on {{rig.name}}">{{part.component.adjusted_display_name()}}</span>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

  <!-- --------------- -->
  <!-- --------------- -->
  <!-- EDIT NAME MODAL -->
  <!-- --------------- -->
  <div class="modal fade" tabindex="-1" role="dialog" id="edit-name-modal">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Edit Name</h4>
        </div>
        <div class="modal-body">
          <p><input type="text" class="ac-input-light large" style="width:100%;" id="change-name-input"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="ac-btn" id="save-name-change-button">Save</button>
          &nbsp;&nbsp;
          <button type="button" class="ac-btn" data-dismiss="modal">Cancel</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <!-- --------------- -->
  <!-- --------------- -->
  <!-- SELECT RIG TYPE MODAL -->
  <!-- --------------- -->
  <div class="modal fade" tabindex="-1" role="dialog" id="rig-type-modal">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Save Your Rig</h4>
        </div>
        <div class="modal-body">
          <h5>Before we save your rig, we would like to know more about it.</h5>
          <div style="text-align: center;">
            <div class="rig-type-selector" data-deselect-img="/static/images/own_rig_select.png"
              data-selected-img="/static/images/own_rig_selected.png"
              data-type="owned">
              <div class="select-rig-type clickable">
                <img src="/static/images/own_rig_select.png">
              </div>
              <div class="select-rig-type-footer">Owned</div>
            </div>
            <div class="rig-type-selector" data-deselect-img="/static/images/exp_rig_select.png"
              data-selected-img="/static/images/exp_rig_selected.png"
              data-type="experimental">
              <div class="select-rig-type clickable">
                <img src="/static/images/exp_rig_select.png">
              </div>
              <div class="select-rig-type-footer">Experimental</div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="ac-btn continue-save-btn">Save</button>
          &nbsp;&nbsp;
          <button type="button" class="ac-btn" data-dismiss="modal">Cancel</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <!-- --------------- -->
  <!-- --------------- -->
  <!-- ADD OWNED PARTS MODAL -->
  <!-- --------------- -->
  <div class="modal fade" tabindex="-1" role="dialog" id="add-owned-parts-modal">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Owned Parts Updated</h4>
        </div>
        <div class="modal-body">
          <h5>You are about to modify a rig that you own. The following parts will be added to your owned parts inventory:</h5>
          <br>
          <div id="owned-parts-list">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="ac-btn continue-save-btn">Save</button>
          &nbsp;&nbsp;
          <button type="button" class="ac-btn" data-dismiss="modal">Cancel</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <!-- --------------- -->
  <!-- --------------- -->
  <!-- LEGEND MODAL -->
  <!-- --------------- -->
  <div class="modal fade" tabindex="-1" role="dialog" id="legend-modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Legend</h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-5 col-md-offset-2" style="text-align: center;"><h3 style="color:#333;">4k@60</h3><h5>3840x2160 @ 60 fps</h5></div>
            <div class="col-md-4"><img src="/static/cube-images/ac-cube-small-purple.png" class="small-cube-icon"></div>
          </div>
          <div class="row">
            <div class="col-md-5 col-md-offset-2" style="text-align: center;"><h3 style="color:#333;">VR</h3><h5>2160x1200 @ 90 fps</h5></div>
            <div class="col-md-4"><img src="/static/cube-images/ac-cube-small-black.png" class="small-cube-icon"></div>
          </div>
          <div class="row">
            <div class="col-md-5 col-md-offset-2" style="text-align: center;"><h3 style="color:#333;">1440p@60</h3><h5>2560x1440 @ 60 fps</h5></div>
            <div class="col-md-4"><img src="/static/cube-images/ac-cube-small-orange.png" class="small-cube-icon"></div>
          </div>
          <div class="row">
            <div class="col-md-5 col-md-offset-2" style="text-align: center;"><h3 style="color:#333;">1080p@60</h3><h5>1920x1080 @ 60 fps</h5></div>
            <div class="col-md-4"><img src="/static/cube-images/ac-cube-small-blue.png" class="small-cube-icon"></div>
          </div>
          <div class="row">
            <div class="col-md-5 col-md-offset-2" style="text-align: center;"><h3 style="color:#333;">1080p@30</h3><h5>1920x1080 @ 30 fps</h5></div>
            <div class="col-md-4"><img src="/static/cube-images/ac-cube-small-green.png" class="small-cube-icon"></div>
          </div>
          <div class="row">
            <div class="col-md-5 col-md-offset-2" style="text-align: center;"><h3 style="color:#333;">720p@60</h3><h5>1280x720 @ 60 fps</h5></div>
            <div class="col-md-4"><img src="/static/cube-images/ac-cube-small-gray.png" class="small-cube-icon"></div>
          </div>
          <div class="row">
            <div class="col-md-5 col-md-offset-2" style="text-align: center;"><h3 style="color:#333;">900p@30</h3><h5>1600x900 @ 30 fps</h5></div>
            <div class="col-md-4"><img src="/static/cube-images/ac-cube-small-gray.png" class="small-cube-icon"></div>
          </div>
          <div class="row">
            <div class="col-md-5 col-md-offset-2" style="text-align: center;"><h3 style="color:#333;">720p@30</h3><h5>1280x720 @ 30 fps</h5></div>
            <div class="col-md-4"><img src="/static/cube-images/ac-cube-small-gray.png" class="small-cube-icon"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="ac-btn" data-dismiss="modal">Close</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <!-- --------------- -->
  <!-- --------------- -->
  <!-- PART PICKER MODAL -->
  <!-- --------------- -->
  <div id="pick-part-modal" class="modal fade">
    <div class="modal-dialog" style="width:980px; height:100%;">
        <div class="modal-content" style="height:85%; ">
          <div style="text-align: center; padding:15px; border-bottom: solid 1px #c1c1c1;">
            <h3 class="modal-title" id="equip-modal-title"></h3>
            <div class="clearfix"></div>
          </div>
          <div style="padding:15px; border-bottom: solid 1px #c1c1c1;">
             <div class="form-inline pull-left">
               &nbsp;&nbsp;
               <input placeholder="Search" id="search-parts-input" class="form-control ac-input-light" type="text"/>
               <input type="checkbox" id="search-show-only-compat-parts"/> Only show compatible parts
             </div>
             <div class="form-inline pull-right">
               <select id="search-manufacturer-select" class="form-control">
                 <option value="">All Manufacturers</option>
               </select>
               <select id="search-rank-select" class="form-control">
                 <option value="">Amdahl Rank</option>
                 <option value="6">4K@60, 3840x2160 @ 60 fps</option>
                 <option value="5">VR, 2160x1200 @ 90 fps</option>
                 <option value="4">1440p@60, 2560x1440 @ 60 fps</option>
                 <option value="3">1080p@60, 1920x1080 @ 60 fps</option>
                 <option value="2">1080p@30, 1920x1080 @ 30 fps</option>
                 <option value="1">720p@60, 1280x720 @ 60 fps</option>
                 <option value="0">Other</option>
               </select>
             </div>
            <div class="clearfix"></div>
          </div>
          
          <!-- ITEM LIST -->
          <div id="part-item-list">
            
          </div>
          <div style="padding:10px; border: solid 1px #545359; background-color: #1b1a22; text-align: center;">
            <button class="ac-btn" id="modal-unequip-btn">UNEQUIP »</button>
            <button class="ac-btn" id="modal-cancel-btn">CANCEL »</button>
            <button class="ac-btn" id="modal-save-btn">SAVE PART »</button>
          </div>
        </div>
      </div>
  </div>
{% endblock %}

{% block javascript %}

<script type="text/javascript">
	//
	// initialize globals
	var AC_GLOBALS = function(){
		return {
			cubeName : {% if cube_name %}'{{cube_name}}'{% else %}null{% endif %},
			preset : {% if preset %}'{{preset}}'{% else %}null{% endif %},
			upgrade : {% if upgrade %}'{{upgrade}}'{% else %}null{% endif %},
			upgradeName : {% if upgrade_name %}'{{upgrade_name}}'{% else %}null{% endif %},
			use : {% if use %}'{{use}}'{% elif rig and rig.use %}'{{rig.use}}'{% else %}null{% endif %},
			rig : {% if rig %}'{{rig.id}}'{% else %}null{% endif %},
			myRig : {% if my_rig %}true{% else %}false{% endif %}
		};
	}();

</script>

<script type="text/javascript">
    //initialize rig (local storage)
    var currentRig = {};
    currentRig['parts'] = currentRig['parts'] || {};
	$(function(){
		
		// set cube name
		currentRig['name'] = (AC_GLOBALS.cubeName !== null) ? AC_GLOBALS.cubeName : 'Cube Name';
		
		// blank rig (new rig with no owner)
		var blankRig = (AC_GLOBALS.rig === null);
		
		// prepare preset values
		if (AC_GLOBALS.preset !== null) {
			populateRigById(AC_GLOBALS.preset);
		} else if (AC_GLOBALS.rig !== null) {
			populateRigById(AC_GLOBALS.rig);
			currentRig['rig_id'] = AC_GLOBALS.rig; // set ID for subsequent saves to update
		} else {
			// initial render
			refreshPartsCache(renderRig);
		}
		
		if (AC_GLOBALS.upgrade !== null) {
			populateRigById(AC_GLOBALS.upgrade);
			currentRig['upgrading'] = AC_GLOBALS.upgrade; // which cube we are upgrading
			if (AC_GLOBALS.upgradeName !== null) currentRig['upgradingName'] = AC_GLOBALS.upgradeName;
		}
		
		// set the usage in the model
		if (AC_GLOBALS.use !== null) {
			currentRig['use'] = AC_GLOBALS.use;
		}
		
		// initialize edited functionality
		// hide all "edited" labels
		$('.label-edited').hide();
		currentRig['edited'] = {};
		
		function populateRigById(rigId){
			//
			//
			// GET RIG INFO, SET, AND RENDER
			$.getJSON( "getrig", {rig_id: rigId}).success(function(data) {
				var presetRig = JSON.parse(data.rig);
				console.log(presetRig);
				if (presetRig['motherboard_component_id'] !== undefined) currentRig['parts']['motherboard_id'] = presetRig['motherboard_component_id'];
                if (presetRig['gpu_component_id'] !== undefined) currentRig['parts']['gpu_id'] = presetRig['gpu_component_id'];
                if (presetRig['memory_component_id'] !== undefined) currentRig['parts']['memory_id'] = presetRig['memory_component_id'];
                if (presetRig['display_component_id'] !== undefined) currentRig['parts']['display_id'] = presetRig['display_component_id'];
                if (presetRig['cpu_component_id'] !== undefined) currentRig['parts']['cpu_id'] = presetRig['cpu_component_id'];
                if (presetRig['power_component_id'] !== undefined) currentRig['parts']['power_id'] = presetRig['power_component_id'];
                if (presetRig['storage_component_id'] !== undefined) currentRig['parts']['storage_id'] = presetRig['storage_component_id'];
                if (presetRig['chassis_component_id'] !== undefined) currentRig['parts']['chassis_id'] = presetRig['chassis_component_id'];
                refreshPartsCache(renderRig);
			});
		}
		
		//
		//
		// initialization complete
		// set up bindings etc.
		//
		//
		
		//
		// Enable editing the name if you own this rig, or if it's a new rig
		//
		if((AC_GLOBALS.myRig && AC_GLOBALS.rig) || !AC_GLOBALS.rig) {
			$('#bench-cube-title').css('cursor','pointer');
			$('#bench-cube-title').click(function(){
				$('#edit-name-modal').modal('show');
				$('#change-name-input').val(currentRig.name);
			});
		}
		$('#save-name-change-button').click(function(){
			$('#edit-name-modal').modal('hide');
			currentRig.name = $('#change-name-input').val();
			currentRig['miscEdited'] = true;
			renderRig();
		});
		
		$('#save-cube-button').click(function(){
			// if the user is logged in this link will click off save
			// else the user will need to register before they can save
			ArcticBasics.isLoggedIn(saveCubePrompt, function(){
				// not logged in
				ArcticBasics.initLogin(saveCubePrompt);
			});
		});
		
		$('#own-this-button').click(function(){
			
			// unchecked will be visible if user intends to mark as owned
			var toggleOwned = $('#owned_uncheck').is(":visible");
			var useStr = toggleOwned ? 'owned' : 'other';
			
			if (useStr === 'owned') {
				currentRig['owned'] = true;
				$('#owned_check').show();
				$('#owned_uncheck').hide();
			} else {
				currentRig['owned'] = false;
				$('#owned_check').hide();
				$('#owned_uncheck').show();
			}
			
			currentRig['miscEdited'] = true;
			renderRig();
			
			
		});
		
		function saveCubePrompt(){
			
			
			if (currentRig.rig_id !== undefined && Object.keys(currentRig['edited']).length === 0) {
				continueSave();
				return;
			}
			
			//
			// show the user which part is changing
			if (currentRig.rig_id !== undefined) {
				// determine the edited parts
				$('#owned-parts-list').empty();
				for (comp in currentRig['edited']) {
					var text = $('#ac-' + comp + '-section').find('.part-item-title').text();
					if (text && text !== '') $('#owned-parts-list').append('<div class="added-owned-part">' + text + '</div>');
				}
				$('#add-owned-parts-modal').modal('show');
			} else {
				//
				// otherwise prompt user with question about rig ownership
				// if this rig is a new rig
				$('#rig-type-modal').modal('show');
			}
			
		}
		
		$('.continue-save-btn').click(continueSave);
		
		function continueSave(){
			var postRig = currentRig['parts'];
			postRig['name'] = currentRig['name'];
			postRig['owned'] = currentRig['owned'] && currentRig['owned'] === true;
			if (currentRig.rig_id !== undefined) postRig['rig_id'] = currentRig.rig_id;
			
			$.post('/savecube', postRig).success(function(data){
				window.location.href = '/bench?rig=' + data.rig_id;
			});
		}
		
		function resetCube(){
		    currentRig = {};
		    currentRig['parts'] = {};
		    renderRig();
		}
		
		// selected item prior to save
		var toEquip = null;
		var equipType = null;
		
		// initialize parts cache with part data by id
		var partsCache = {};
 		
 		//
 		// dismiss modal after saving
 		//
 		$('#modal-save-btn').click(function(){
 			
 			// set edited part
 			var currEquipId = currentRig['parts'][equipType + '_id'];
 			if (currEquipId !== toEquip) currentRig['edited'][equipType] = true; // edited part
 			
 			// set part to equip in view
 			console.log('equip ' + equipType + ' ' + toEquip);
 			currentRig['parts'][equipType + '_id'] = toEquip;
 			$('#part-item-list').empty();
 			$('#pick-part-modal').modal('hide');
 			renderRig();
 		});
 		
 		$('#modal-unequip-btn').click(function(){
 			console.log('unequip ' + equipType);
 			currentRig['parts'][equipType + '_id'] = null;
 			$('#part-item-list').empty();
 			$('#pick-part-modal').modal('hide');
 			renderRig();
 		});
 		
 		//
 		// dismiss modal (cancel)
 		//
 		$('#modal-cancel-btn').click(function(){
 			$('#part-item-list').empty();
 			$('#pick-part-modal').modal('hide');
 		});
		
		//
		// equip buttons - show modal and load parts
		//
		if(AC_GLOBALS.myRig || blankRig) {
    		$('.equipbutton').click(renderPartPickerModal);
    		$('.equip-clickable').click(renderPartPickerModal);
		} else {
			$('.equip-clickable').css('cursor', 'auto');
		}

		//
		// Search when any serach input changes, hook up event listeners
		//
		$('#search-parts-input').keyup(function(){ searchPartsAndRenderResult(); });
		$('#search-show-only-compat-parts').change(function(){ searchPartsAndRenderResult(); });
		$('#search-rank-select').change(function(){ searchPartsAndRenderResult(); });
		$('#search-manufacturer-select').change(function(){ searchPartsAndRenderResult(); });

		function searchPartsAndRenderResult() {
			var searchPartsParams = {};
			searchPartsParams.target = equipType;
			searchPartsParams.q = $('#search-parts-input').val();
			searchPartsParams.rank = $('#search-rank-select').val();
			searchPartsParams.manufacturer = $('#search-manufacturer-select').val();
			$.extend(searchPartsParams, currentRig['parts']);

			if($('#search-show-only-compat-parts').is(':checked')) {
				searchPartsParams.compat = $('#search-show-only-compat-parts').is(':checked')
			}

			var currentEquippedId = currentRig['parts'][equipType + '_id'];
			
			$.getJSON( "/parts/search", searchPartsParams).success(function(data) {
	        	
	        	renderFromPartsList(data, currentEquippedId);
	        	
	        	bindEquipListener();

	        }).fail(function() {
	            console.log( "error" );
	        });
		}
		
		//
		// Rendering PART PICKER MODAL
		//
		function renderPartPickerModal() {
			var eType = $(this).parent().data('equip-type');
			equipType = eType;
			
			//
			// clear out search options
			$('#search-manufacturer-select').html('<option value="">All Manufacturers</option>');
 			$('#search-rank-select').val('');
 			$('#search-parts-input').val('');
 			$('#search-show-only-compat-parts').prop('checked', false);
 			
			//
			// clear out any previously selected parts
			toEquip = null;
			
			//
			// set title
			var equipTitle = $(this).parent().data('equip-title');
			$('#equip-modal-title').html(equipTitle);
			
			var currentEquippedId = currentRig['parts'][eType + '_id'];
	        
	        // Call server with datatype and current PC config
	        var getPartsParams = {};
	        getPartsParams.target = eType;
	        $.extend(getPartsParams, currentRig['parts']);
	        $.getJSON( "getparts", getPartsParams).success(function(data) {
	        	
	        	renderFromPartsList(data, currentEquippedId);
	        	
	        	bindEquipListener();

	        }).fail(function() {
	            console.log( "error" );
	        });

			$.getJSON( "/manufacturers/get", {target: eType}).success(function(data) {
	        	
	        	for(i=0;i<data.length;i++){
	        		$('#search-manufacturer-select').append(
	        			'<option value="' + data[i] + '">' + data[i] + '</option>'
	        		);
	        	}

	        }).fail(function() {
	            console.log( "error" );
	        });
			
			$('#pick-part-modal').modal('show');
		}

		function renderFromPartsList(data, currentEquippedId) {
			var itemListView = $('#part-item-list');
        	itemListView.empty();
        	
			var partsList = JSON.parse(data.parts);
        	for (part in partsList) {	        		
        		var component = partsList[part];
        		
        		//
        		// add to parts cache (needed later)
        		partsCache[component.id] = component;
        		
    			var itemDiv = $('<div class="equip-part-item"></div>')
    			var contentDiv = $('<div class="part-item-content"></div>')
    			var iconDiv = $('<div class="part-icon-div"></div>')
    			var titleSpan = $('<span class="part-item-title">' + constructDisplayName(component) + '</span>');
    			
    			itemDiv.append(iconDiv);
    			itemDiv.append(contentDiv);
    			contentDiv.append(titleSpan);
    			
    			//
    			// set component ID
    			//
    			itemDiv.data('component-id', component.id);
    			
    			// style current equipped if exists
    			if (currentEquippedId === component.id) {
    				itemDiv.addClass('equipped');
    			} else {
    				itemDiv.addClass("not-equipped");
    			}
    			
    			if (component.compatible === true) {
    				iconDiv.append('<img class="modal-color-icon" src="/static/images/modal-box-rarity-'+component.perf_color+'.png"/>') 	// color icon
    				titleSpan.addClass('fg-' + component.perf_color);											// style title span
    				contentDiv.append('<span class="part-item-sub">' + constructPerformanceNote(component) + '</span>');
    				
    				// add any flags
        			// adding recommended to all for now
        			if (component.recommended === true ) {
        				itemDiv.addClass('recommended-item');
        			}
    				
    				// make item clickable (equippable)
    				itemDiv.addClass('equippable-item');
    				
    			} else {        				
    				iconDiv.append('<img class="modal-color-icon" src="/static/images/modal-box-rarity-incompatible.png"/>') 	// append incompat icon
    				contentDiv.append('<span class="part-item-sub fg-inc-red">INCOMPATIBLE</span>'); 			// incompatible text
    				titleSpan.addClass('fg-inc'); 															// title color
    				
    				// item cannot be equipped
    				itemDiv.removeClass('equippable-item');
    			}
    			
    			itemListView.append(itemDiv);
    			
        	}
		}
		
		//
		// Equip Part Item onClick
		// Change styling
		//
		function bindEquipListener(){
			$('.equippable-item').click(function(){
				// remove equip styling from all components
				$('.equip-part-item').removeClass('equipped');
				$(this).addClass('equipped');
				$(this).removeClass('not-equipped');
				toEquip = $(this).data('component-id');
				console.log('the data: ' + toEquip);
			});
		}
		
		//
		// Render Bench View
		//
		function renderRig() {
			console.log('Rendering Rig');
			console.log(currentRig);
			
			// reset to fresh UI
			resetBenchUI();
			
			//
			//
			// Disable save and share button (assume cube positions have not all been filled)
			$('#save-my-cube-button').prop('disabled', true);
			$('#benchtab-share').addClass('benchtab-disabled');
			
			var coreComponentCount = 0;
			var worstComponent = null;
			var worstComponentDetail = null;
			
			// render the current rig
			for (comp in currentRig['parts']) {
				
				var compId = currentRig['parts'][comp];
				if (compId === null || compId === undefined) {
					continue;
				}
				
				// pull part and information from cache
				var partDetail = partsCache[compId];
				
				// comptype
				var compType = comp.substr(0, comp.indexOf('_id'));
				console.log('comp type: ' + compType);
				
				// modify view
				if (isCoreComponent(compType)) {
					// modify core view
					renderCoreComponent(compType, partDetail);
					
					//
					// incremenent component count
					// and set worst component
					if (isCoreComponent(compType)) {
						coreComponentCount++;
						if (worstComponent == null || partDetail.perf_color_coded < worstComponent) {
								worstComponent = partDetail.perf_color_coded;
								worstComponentDetail = partDetail;
						}
					}
				} else{
					// modify other view
					renderOtherComponent(compType, partDetail);
				}
				
			}
			
			if (coreComponentCount == 4) {
				// set center cube and avatar cubes
				$('#ac-cubedisplay-middle').attr('src','/static/cube-images/ac-cube-middle-' + worstComponentDetail.perf_color + '.png');
				$('#bench-cube-title').addClass('border-' + worstComponentDetail.perf_color);
				$('#bench-cube-subtitle').html(constructPerformanceNote(worstComponentDetail));
				
				// enable save button and share button
				if (AC_GLOBALS.myRig) {
					$('#save-cube-button').text('Update Cube');
					$('#save-cube-button').show();
					if (currentRig && (Object.keys(currentRig['edited']).length > 0 || currentRig['miscEdited'] === true)) {
						$('#save-cube-button').attr('disabled', false);
					}
					else {
						$('#save-cube-button').attr('disabled', true);
					}
				} else if (blankRig) {
					$('#save-cube-button').text('Save Cube');
					$('#save-cube-button').show();
				}
				$('#benchtab-share').removeClass('benchtab-disabled');
				
				// enable equiping secondary components
				if (AC_GLOBALS.myRig || blankRig) {
					$('.other-clickable').click(renderPartPickerModal);
					$('.other-clickable').addClass('pointer');
				}
				$('.other-component-note').hide();
			} else {
				$('.other-clickable-btn').hide();
			}
			
			// set rig name
			if (currentRig.name !== undefined) {
				$('#bench-cube-title').html(currentRig['name']);
			}
			
			// render edited flags
			if (currentRig.rig_id !== undefined && currentRig.rig_id !==null){
				for (comp in currentRig['edited']) {
					renderEditedFlag(comp);
				}
			}
			
		}
		
		function toRigUseString(useEnum){
			if (useEnum === 'current') return "This is my current rig.";
			else if (useEnum === 'upgrade') return "This is an upgrade from your current rig.";
			else if (useEnum === 'fresh') return "This is a brand new rig.";
			else if (useEnum === 'recommend') return "I recommend this rig.";
			return null;
		}
		
		function renderCoreComponent(compType, partDetail){
			// modify core view
			var view = $('#ac-' + compType + '-section');
			view.prev().hide();// hide equip button
			view.empty();
			
			var displaySpan = $('<span></span>');
			displaySpan.append(constructDisplayName(partDetail));
			displaySpan.addClass('fg-' + partDetail.perf_color);
			displaySpan.addClass('part-item-title'); // styling

			view.append(displaySpan.clone());
			view.append('<br><span>' + constructPerformanceNote(partDetail) + '</span>')
			
			// modify colors
			$('#ac-cubedisplay-' + compType).attr('src',
					'/static/cube-images/ac-cube-small-' + partDetail.perf_color + '.png');
		}
		
		function renderOtherComponent(compType, partDetail){
			// modify core view
			var view = $('#ac-' + compType + '-section');
			view.prev().hide();// hide equip button
			view.empty();
			
			var displaySpan = $('<span></span>');
			displaySpan.append(constructDisplayName(partDetail));
			displaySpan.addClass('part-item-title'); // styling

			view.append(displaySpan.clone());
			
		}
		
		function renderEditedFlag(compType){
			// modify core view
			var view = $('#ac-' + compType + '-section');
			view.siblings('.label-edited').show();
		}
		
		function resetBenchUI(){
			//
			//
			// RESET Cube positions
			$('#ac-cubedisplay-middle').attr('src','/static/cube-images/ac-cube-middle-default.png');
			$('#ac-cubedisplay-gpu').attr('src','/static/cube-images/ac-cube-small-default.png');
			$('#ac-cubedisplay-cpu').attr('src','/static/cube-images/ac-cube-small-default.png');
			$('#ac-cubedisplay-memory').attr('src','/static/cube-images/ac-cube-small-default.png');
			$('#ac-cubedisplay-display').attr('src','/static/cube-images/ac-cube-small-default.png');
			$('#bench-cube-title').removeClass();
			$('#bench-cube-subtitle').empty();
			$('#bench-upgrade-subtitle').empty();
			$('#bench-rig-use-subtitle').empty();
			
			//
			//
			// Remove display titles
			$('.item-slot-section').empty();
			
			//
			//
			// show all equip buttons
			$('.equipbutton').show();
			$('.other-clickable-btn').show();
			
			//
			//
			// Other components cannot be edited by default (assuming cube not filled)
			$('.other-clickable').removeClass('pointer');
			$('.other-clickable').unbind();
			$('.other-component-note').show();
			
			//
			//
			// Do not show save cube button
			$('#save-cube-button').hide();
			
			//
			// Hide all edited labels
			$('.label-edited').hide();
		}
		
		function constructDisplayName(part){
			var partName = "";
			if (part.display_name !== null && part.display_name !== undefined && part.display_name !== '') return part.display_name;
			if (part.vendor !== undefined && part.vendor !== null) partName += part.vendor + ' ';
			if (part.brand_name !== undefined && part.brand_name !== null) partName += part.brand_name + ' ';
			if (part.model_number !== undefined && part.model_number !== null) partName += part.model_number;
			return partName;
		}
		
		function constructPerformanceNote(part){
			var note = "";
			if (part.max_performance !== undefined && part.max_performance !== null) note += part.max_performance + ' ';
			if (part.resolution !== undefined && part.resolution !== null) note += part.resolution;
			if (part.max_framerate !== undefined && part.max_framerate !== null) note += '<br>' + part.max_framerate + ' Hz Refresh Rate';
			return note;
		}
		
		function isCoreComponent(compType) {
			return compType === 'memory' || compType === 'display' || compType === 'cpu' || compType === 'gpu';
		}
		
		function refreshPartsCache(renderFunc){
			// retrieve necessary parts from server
			var ids = '';
			var count = 0;
			for (part in currentRig['parts']) {
				count++;
				if (currentRig['parts'][part] === null) continue;
				
				ids += currentRig['parts'][part];
				if (count < Object.keys(currentRig.parts).length) {
					ids += ',';
				}
			}
			if (ids.length === 0) renderFunc();
			$.getJSON( "getparts", {ids:ids}).success(function(data) {
				var partsList = JSON.parse(data.parts);
	        	for (part in partsList) {
	        		var component = partsList[part];
	        		partsCache[component.id] = component;
	        	}
	        	
	        	if (renderFunc !== null) {
	        		renderFunc();
	        	}
			});
		}
		
		$('#change-cube-select').change(function(){
			window.location.href = $(this).find(":selected").data('location');
		});

		$('#show-cube-summary').click(function(){
			$('#build-cube-div').show();
			$('#other-components-bg').show();
			$('#share-cube-div').hide();
		});

		$('#show-share-cube').click(function(){
			$('#share-cube-div').show();
			$('#build-cube-div').hide();
			$('#owned-parts-div').hide();
		});
		
		$('#back-to-cube-btn').click(function(){
			$('#share-cube-div').hide();
			$('#build-cube-div').show();
			$('#owned-parts-div').show();
		});

		$('#twitter-share-btn').attr('href', 'https://twitter.com/share?url=' + window.location.href);

		$('#facebook-share-btn').attr('href', 'https://www.facebook.com/sharer.php?u=' + window.location.href);

		$('#reddit-share-btn').attr('href', 'http://www.reddit.com/submit?url=' + window.location.href);

		$('#get-share-link-btn').click(function(){
			$('#share-link-input').val(window.location.href);
			$('#share-link-div').show();
		});

		$('#copy-share-link-btn').click(function(){
			$('#share-link-input').val($('#share-link-input').val()).select();
			document.execCommand("copy");
		});
		
		$('#legendIconButton').click(function(){
			// open legend modal
			$('#legend-modal').modal('show');
			
		});
		
		$('.rig-type-selector').click(function(){
			
			// select one
			var rigSelect = $(this).find('.select-rig-type');
			var selectUrl = $(this).data('selected-img');
			var rigType = $(this).data('type');
			currentRig['owned'] = rigType === 'owned';
			rigSelect.addClass('selected-rig-type').removeClass('select-rig-type').find('img').attr('src', selectUrl);
			
			
			// deselect the other one
			var otherSelector = $(this).siblings('.rig-type-selector'); 
			var rigDeselect = otherSelector.find('.selected-rig-type');
			var deselectUrl = otherSelector.data('deselect-img');
			rigDeselect.addClass('select-rig-type').removeClass('selected-rig-type').find('img').attr('src', deselectUrl);
			
		});

	});

	
	
</script>
{% endblock %}


